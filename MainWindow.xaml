<Window x:Class="SpeedCubeTimer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:oxy="http://oxyplot.org/wpf"
        Title="Speed Cube Timer" Height="900" Width="1200"
        WindowStartupLocation="CenterScreen"
    Loaded="Window_Loaded"
    Background="#F5F5F5">
    <Window.Resources>
        <!-- ComboBox Style -->
        <Style TargetType="ComboBox">
            <Setter Property="Background" Value="#FFFFFF"/>
            <Setter Property="Foreground" Value="#000000"/>
            <Setter Property="BorderBrush" Value="#D0D0D0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="Height" Value="32"/>
        </Style>
        
        <!-- ComboBoxItem Style -->
        <Style TargetType="ComboBoxItem">
            <Setter Property="Background" Value="#FFFFFF"/>
            <Setter Property="Foreground" Value="#000000"/>
            <Setter Property="Padding" Value="8,6"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E3F2FD"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#0173B2"/>
                    <Setter Property="Foreground" Value="#FFFFFF"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- ListBox Style -->
        <Style TargetType="ListBox">
            <Setter Property="Background" Value="#FFFFFF"/>
            <Setter Property="Foreground" Value="#000000"/>
            <Setter Property="BorderBrush" Value="#D0D0D0"/>
        </Style>
        
        <!-- ListBoxItem Style with explicit template to keep text readable when selected -->
        <Style TargetType="ListBoxItem">
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="Background" Value="#FFFFFF"/>
            <Setter Property="Foreground" Value="#000000"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="BorderBrush" Value="#D0D0D0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border x:Name="Bd"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#0173B2"/>
                                <Setter Property="Foreground" Value="#FFFFFF"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#E3F2FD"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="400"/>
        </Grid.ColumnDefinitions>
        
        <!-- Top Header -->
        <Border Grid.Row="0" Grid.ColumnSpan="2" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1" Background="#FFFFFF" Padding="20">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                <TextBlock Text="â± Speed Cube Timer" 
                           FontSize="24" 
                           FontWeight="Bold"
                           Foreground="#0173B2"
                           VerticalAlignment="Center"/>
                <TextBlock Name="StatusText"
                           Text="Press SPACE to start"
                           FontSize="14"
                           Foreground="#424242"
                           TextAlignment="Center"
                           Margin="40,0,0,0"
                           VerticalAlignment="Center"
                           FontStyle="Italic"/>
                <!-- Puzzle Selection -->
                <StackPanel Orientation="Horizontal" Margin="60,0,0,0" VerticalAlignment="Center">
                    <TextBlock Text="Puzzle:" 
                               FontSize="12" 
                               Foreground="#424242"
                               VerticalAlignment="Center"
                               Margin="0,0,10,0"/>
                    <ComboBox Name="PuzzleSelection"
                              Width="120"
                              Height="32"
                              FontSize="12"
                              Foreground="#000000"
                              Background="#FFFFFF"
                              BorderBrush="#CCCCCC"
                              SelectionChanged="PuzzleSelection_SelectionChanged"
                              VerticalAlignment="Center"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Main Center Area: Timer + Controls -->
        <StackPanel Grid.Row="1" Grid.Column="0" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="40">
            
            <!-- Scramble Display -->
            <Border BorderBrush="#D0D0D0" BorderThickness="1" CornerRadius="4" Padding="10" Margin="0,0,0,15" Background="#FFFFFF" MaxWidth="500" MinHeight="40">
                <TextBlock Name="ScrambleText"
                           Text="Scramble will appear here"
                           FontSize="11"
                           Foreground="#424242"
                           TextAlignment="Center"
                           TextWrapping="Wrap"
                           FontFamily="Courier New"/>
            </Border>

            <!-- Timer Display - Large and Central -->
            <Border BorderBrush="#BDBDBD" BorderThickness="3" CornerRadius="12" Padding="40" Margin="0,0,0,20" Background="#FFFFFF" Width="500" Height="280">
                <StackPanel VerticalAlignment="Center">
                    <TextBlock Name="TimerDisplay" 
                               Text="00:00.00" 
                               FontSize="100" 
                               FontWeight="Bold"
                               Foreground="#0173B2"
                               TextAlignment="Center"
                               FontFamily="Courier New"
                               LineHeight="Auto"/>
                    <!-- Inspection Timer Display -->
                    <TextBlock Name="InspectionTimerDisplay"
                               Text=""
                               FontSize="20"
                               Foreground="#DE8F05"
                               TextAlignment="Center"
                               FontFamily="Courier New"
                               Margin="0,15,0,0"/>
                </StackPanel>
            </Border>

            <!-- Control Buttons -->
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,20">
                <Button Name="StartButton" 
                        Content="â–¶ Start" 
                        Width="120" Height="50"
                        FontSize="14"
                        Click="StartButton_Click"
                        Background="#029E73"
                        Foreground="White"
                        FontWeight="Bold"
                        Cursor="Hand"
                        Margin="5,0"/>
                <Button Name="StopButton" 
                        Content="â¹ Stop" 
                        Width="120" Height="50"
                        FontSize="14"
                        Click="StopButton_Click"
                        Background="#D55E00"
                        Foreground="White"
                        IsEnabled="False"
                        FontWeight="Bold"
                        Cursor="Hand"
                        Margin="5,0"/>
                <Button Name="ResetButton" 
                        Content="â†º Reset" 
                        Width="120" Height="50"
                        FontSize="14"
                        Click="ResetButton_Click"
                        Background="#0173B2"
                        Foreground="White"
                        FontWeight="Bold"
                        Cursor="Hand"
                        Margin="5,0"/>
            </StackPanel>

            <!-- Quick keyboard hints to reduce confusion -->
            <Border Background="#FFFFFF" BorderBrush="#D0D0D0" BorderThickness="1" CornerRadius="6" Padding="10" Margin="0,0,0,24" MaxWidth="520">
                <TextBlock FontSize="11" Foreground="#424242">
                    <Run Text="Space: hold 0.5s to start; tap to stop Â· R: reset session Â· Delete: remove selected solve Â· Click chart point to select"/>
                </TextBlock>
            </Border>

            <!-- Inspection Timer Controls -->
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,20">
                <Button Name="InspectionStartButton" 
                        Content="ðŸ” Inspect" 
                        Width="120" Height="40"
                        FontSize="12"
                        Click="InspectionStartButton_Click"
                        Background="#CC78BC"
                        Foreground="White"
                        FontWeight="Bold"
                        Cursor="Hand"
                        Margin="5,0"/>
            </StackPanel>

            <!-- Penalty Buttons -->
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,40">
                <Button Name="Plus2Button" 
                        Content="+ 2s" 
                        Width="100" Height="40"
                        FontSize="12"
                        Click="Plus2Button_Click"
                        Background="#DE8F05"
                        Foreground="White"
                        FontWeight="Bold"
                        Cursor="Hand"
                        Margin="5,0"/>
                <Button Name="DNFButton" 
                        Content="DNF" 
                        Width="100" Height="40"
                        FontSize="12"
                        Click="DNFButton_Click"
                        Background="#D55E00"
                        Foreground="White"
                        FontWeight="Bold"
                        Cursor="Hand"
                        Margin="5,0"/>
                <Button Name="ClearPenaltyButton" 
                        Content="Clear" 
                        Width="100" Height="40"
                        FontSize="12"
                        Click="ClearPenaltyButton_Click"
                        Background="#0173B2"
                        Foreground="White"
                        FontWeight="Bold"
                        Cursor="Hand"
                        Margin="5,0"/>
            </StackPanel>

            <!-- Statistics -->
            <Border BorderBrush="#D0D0D0" BorderThickness="1" CornerRadius="8" Padding="20" Background="#FFFFFF" Width="380">
                <StackPanel>
                    <TextBlock Text="Session Statistics" 
                               FontSize="12" 
                               FontWeight="Bold"
                               Foreground="#424242"
                               Margin="0,0,0,15"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                            <TextBlock Text="Best" FontSize="11" Foreground="#424242" TextAlignment="Center" Margin="0,0,0,6"/>
                            <TextBlock Name="BestTimeText" Text="--:--" FontSize="16" FontWeight="Bold" Foreground="#0173B2" TextAlignment="Center"/>
                        </StackPanel>
                        <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                            <TextBlock Text="Average" FontSize="11" Foreground="#424242" TextAlignment="Center" Margin="0,0,0,6"/>
                            <TextBlock Name="AverageTimeText" Text="--:--" FontSize="16" FontWeight="Bold" Foreground="#DE8F05" TextAlignment="Center"/>
                        </StackPanel>
                        <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                            <TextBlock Text="Worst" FontSize="11" Foreground="#424242" TextAlignment="Center" Margin="0,0,0,6"/>
                            <TextBlock Name="WorstTimeText" Text="--:--" FontSize="16" FontWeight="Bold" Foreground="#D55E00" TextAlignment="Center"/>
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Border>
        </StackPanel>

        <!-- Right Sidebar: History + Plot -->
        <Border Grid.Row="1" Grid.Column="1" BorderBrush="#E0E0E0" BorderThickness="1,0,0,0" Background="#FAFAFA">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="20">
                    
                    <!-- Solve History -->
                    <TextBlock Text="Solve History" 
                               FontSize="13" 
                               FontWeight="Bold"
                               Foreground="#212121"
                               Margin="0,0,0,12"/>
                    <Border BorderBrush="#D0D0D0" BorderThickness="1" CornerRadius="6" Padding="10" Margin="0,0,0,20" Background="#FFFFFF">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <TextBlock Text="Solves:" FontSize="11" Foreground="#424242" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <Button Name="DeleteButton" 
                                        Content="âœ• Delete" 
                                        Width="75" Height="26"
                                        FontSize="10"
                                        Click="DeleteButton_Click"
                                        Background="#D55E00"
                                        Foreground="White"
                                                                                IsEnabled="False"
                                        FontWeight="Bold"
                                        Cursor="Hand"/>
                            </StackPanel>
                                                        <TextBlock Name="EmptyHistoryText"
                                                                             Text="No solves yet. Press Space to start a timed solve."
                                                                             FontSize="11"
                                                                             Foreground="#757575"
                                                                             Margin="0,0,0,6"/>
                            <ListBox Name="TimesListBox" 
                                     Background="#FFFFFF"
                                     Foreground="#000000"
                                     Height="120"
                                     SelectionChanged="TimesListBox_SelectionChanged"
                                                                         PreviewKeyDown="TimesListBox_PreviewKeyDown"
                                     BorderBrush="#D0D0D0"
                                     BorderThickness="1"
                                     Padding="8"/>
                        </StackPanel>
                    </Border>

                    <!-- Trend Plot -->
                    <TextBlock Text="Performance Trend" 
                               FontSize="13" 
                               FontWeight="Bold"
                               Foreground="#212121"
                               Margin="0,0,0,12"/>
                    <oxy:PlotView Name="TrendPlot" 
                                  Model="{Binding PlotModel}"
                                  Margin="0"
                                  Height="400"
                                  Background="#FFFFFF"
                                  PreviewMouseDown="TrendPlot_PreviewMouseDown"
                                  PreviewMouseMove="TrendPlot_PreviewMouseMove"/>
                </StackPanel>
            </ScrollViewer>
        </Border>
    </Grid>
</Window>
